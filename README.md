# Olbrasoft.TextToSpeech

[![Build & Publish](https://github.com/Olbrasoft/TextToSpeech/actions/workflows/publish-nuget.yml/badge.svg)](https://github.com/Olbrasoft/TextToSpeech/actions/workflows/publish-nuget.yml)
[![License](https://img.shields.io/badge/license-MIT-green)](LICENSE)
[![.NET](https://img.shields.io/badge/.NET-10.0-blue)](https://dotnet.microsoft.com/)

A comprehensive .NET library for Text-to-Speech synthesis with multiple providers, circuit breaker pattern, and automatic fallback support.

## Packages

| Package | Description | NuGet |
|---------|-------------|-------|
| **Olbrasoft.TextToSpeech.Core** | Core interfaces and models (ITtsProvider, TtsRequest, TtsResult) | [![NuGet](https://img.shields.io/nuget/v/Olbrasoft.TextToSpeech.Core.svg)](https://www.nuget.org/packages/Olbrasoft.TextToSpeech.Core/) |
| **Olbrasoft.TextToSpeech.Providers** | Provider implementations (Azure, EdgeTTS, Google, VoiceRSS) | [![NuGet](https://img.shields.io/nuget/v/Olbrasoft.TextToSpeech.Providers.svg)](https://www.nuget.org/packages/Olbrasoft.TextToSpeech.Providers/) |
| **Olbrasoft.TextToSpeech.Providers.Piper** | Piper TTS provider for offline synthesis using ONNX models | [![NuGet](https://img.shields.io/nuget/v/Olbrasoft.TextToSpeech.Providers.Piper.svg)](https://www.nuget.org/packages/Olbrasoft.TextToSpeech.Providers.Piper/) |
| **Olbrasoft.TextToSpeech.Orchestration** | Orchestration with circuit breaker and multi-provider fallback | [![NuGet](https://img.shields.io/nuget/v/Olbrasoft.TextToSpeech.Orchestration.svg)](https://www.nuget.org/packages/Olbrasoft.TextToSpeech.Orchestration/) |

## Features

- **Multiple TTS Providers**: Azure Cognitive Services, Edge TTS, Google TTS, VoiceRSS, and Piper (offline)
- **Circuit Breaker Pattern**: Automatic failure detection with exponential backoff using Polly
- **Provider Fallback Chain**: Automatic failover to backup providers when primary fails
- **Configurable Priority**: Define provider priority order via configuration
- **Offline Support**: Piper provider works completely offline with ONNX neural voice models
- **Voice Profiles**: Configure different voice settings per use case

## Installation

```bash
# Core abstractions
dotnet add package Olbrasoft.TextToSpeech.Core

# Cloud providers (Azure, Edge TTS, Google, VoiceRSS)
dotnet add package Olbrasoft.TextToSpeech.Providers

# Offline Piper provider
dotnet add package Olbrasoft.TextToSpeech.Providers.Piper

# Orchestration with circuit breaker
dotnet add package Olbrasoft.TextToSpeech.Orchestration
```

## Quick Start

### 1. Register Services

```csharp
// Program.cs
using Olbrasoft.TextToSpeech.Providers.Extensions;
using Olbrasoft.TextToSpeech.Providers.Piper.Extensions;
using Olbrasoft.TextToSpeech.Orchestration.Extensions;

builder.Services.AddTtsProviders(configuration);      // Azure, EdgeTTS, Google, VoiceRSS
builder.Services.AddPiperTts(configuration);          // Piper (offline)
builder.Services.AddTtsOrchestration(configuration);  // Circuit breaker & fallback chain
```

### 2. Configure Providers

```json
{
  "TTS": {
    "Orchestration": {
      "Providers": [
        { "Name": "EdgeTTS-HTTP", "Priority": 1, "Enabled": true },
        { "Name": "AzureTTS", "Priority": 2, "Enabled": true },
        { "Name": "Piper", "Priority": 3, "Enabled": true }
      ]
    },
    "EdgeTTS": {
      "BaseUrl": "http://localhost:5555",
      "DefaultVoice": "cs-CZ-AntoninNeural"
    },
    "AzureTTS": {
      "SubscriptionKey": "your-key",
      "Region": "westeurope",
      "DefaultVoice": "cs-CZ-AntoninNeural"
    },
    "Piper": {
      "ModelPath": "/path/to/model.onnx",
      "PiperPath": "piper"
    }
  }
}
```

### 3. Use the Service

```csharp
public class SpeechService
{
    private readonly ITtsProviderChain _ttsChain;

    public SpeechService(ITtsProviderChain ttsChain)
    {
        _ttsChain = ttsChain;
    }

    public async Task<byte[]?> SpeakAsync(string text, CancellationToken ct = default)
    {
        var request = new TtsRequest
        {
            Text = text,
            Voice = "cs-CZ-AntoninNeural",
            Rate = 10,  // +10%
            Pitch = 0   // default
        };

        var result = await _ttsChain.SynthesizeAsync(request, ct);

        if (result.Success)
        {
            Console.WriteLine($"Audio generated by: {result.ProviderUsed}");
            return result.Audio?.ToArray();
        }

        Console.WriteLine($"TTS failed: {result.ErrorMessage}");
        return null;
    }
}
```

## Supported Providers

| Provider | Type | Features |
|----------|------|----------|
| **Azure Cognitive Services** | Cloud | High quality, many voices, SSML support |
| **Edge TTS** | Cloud/Self-hosted | Free, Microsoft voices via HTTP server |
| **Google TTS** | Cloud | Free tier available, many languages |
| **VoiceRSS** | Cloud | Free tier, simple API |
| **Piper** | Local | Offline, ONNX models, custom voices |

## Circuit Breaker Configuration

```json
{
  "CircuitBreaker": {
    "FailureThreshold": 3,
    "ResetTimeout": "00:05:00",
    "UseExponentialBackoff": true,
    "MaxResetTimeout": "01:00:00"
  }
}
```

## Building from Source

```bash
git clone https://github.com/Olbrasoft/TextToSpeech.git
cd TextToSpeech
dotnet build
dotnet test
```

## Requirements

- .NET 10.0 or later
- For Piper: piper-tts binary and ONNX voice model
- For Edge TTS: edge-tts-server running (optional)

## License

MIT License - see [LICENSE](LICENSE) for details.

## Author

**Jiri Tuma** | [Olbrasoft](https://github.com/Olbrasoft)

---

<p align="center">
  <img src="./assets/text-to-speech.png" alt="Text-to-Speech" width="128" />
</p>

<p align="center"><strong>Copyright 2024-2025 Olbrasoft</strong></p>
